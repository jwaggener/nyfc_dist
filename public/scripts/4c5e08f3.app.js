"use strict";function NyfcCanvasService(){function a(a,c,d){return j=a,k=c,l=d,o=3,p=125*o,m=document.createElement("canvas"),m.height=m.width=p,n=m.getContext("2d"),n.fillStyle=k,n.fillRect(0,0,p,p),g(j,l),b(j),m}function b(a){var b,d,e,f,g=h(a),j=i(g,[p-15],24),k=0,l=[];for(b=1;b<j.length;b+=1){for(e=j[b].position,f=j[b].ratio,d=k;d<g.length;d+=1)if("box"===g[d].type||"penalty"===g[d].type&&g[d].penalty===-Typeset.linebreak.infinity){k=d;break}l.push({ratio:f,nodes:g.slice(k,e+1),position:e}),k=e}for(var m=l.length-1,o=360;m>=0;)c(l[m],o),m--,o-=n.lineheight}function c(a,b){var c=15;a.nodes.forEach(function(d,e,f){"box"===d.type?(n.fillText(d.value,c,b),c+=d.width):"glue"===d.type?c+=d.width+a.ratio*(a.ratio<0?d.shrink:d.stretch):"penalty"===d.type&&100===d.penalty&&e===f.length-1&&n.fillText("-",c,b)})}function d(a){var b=a.split(" "),c=_.max(b,function(a){return a.length}).length;return c>=16?FormattingOptions.xsmall:c>=10?FormattingOptions.small:c>=7?FormattingOptions.medium:c>=4?FormattingOptions.large:FormattingOptions.xlarge}function e(a){return a>.85?"#191919":"#ffffff"}function f(a,b,c){var f=d(a);return"background-color:"+b+";color:"+e(c)+";font:bold "+f.fontSize+"px sans-serif;line-height:"+f.lineheight+"px;"}function g(a,b){var c;n.textAlign="left",n.textBaseline="bottom",n.fillStyle=e(b),c=d(a),n.font="bold "+c.fontSize*o+"px sans-serif",n.lineheight=c.lineheight*o}function h(a,b){var c;return c=Typeset.formatter(function(a){return n.measureText(a).width}),c.left(a)}function i(a,b,c){var d=Typeset.linebreak(a,b,{tolerance:c});return 0===d.length&&(d=[{position:0,ratio:0},{position:4,ratio:13}]),d}var j,k,l,m,n,o,p;return o=3,p=125*o,m=document.createElement("canvas"),m.height=m.width=p,n=m.getContext("2d"),{getNyfcCanvas:a,canvas:m,context:n,selectSize:d,getColor:e,getStyleString:f,setContextStyles:g,getNodes:h}}angular.module("nyfcApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/:id?",{templateUrl:"partials/main.html"}).otherwise({redirectTo:"/"})}]);var nyfc=angular.module("nyfcApp");nyfc.controller("nyfcUser",["$scope",function(a){FB.Event.subscribe("auth.authResponseChange",function(b){"connected"===b.status&&FB.api("/me",function(b){a.user=b,a.safeApply()})}),FB.getLoginStatus(function(b){"connected"===b.status&&FB.api("/me",function(b){a.user=b,a.safeApply()})}),a.handleShare=function(a,b,c,d,e){var f=window.location.origin+window.location.pathname+"#"+a,g=String(b+"_"+c+"_"+d+"_"+e).split(" ").join("_")+".png",h="http://s3.amazonaws.com/nyfc-images/images/nyfc/"+g;FB.getLoginStatus(function(a){"connected"===a.status?FB.ui({method:"feed",name:"Name Your Favorite Color",link:f,picture:h,caption:b,description:"Follow the link to check it out and name your favorite color!"},function(a){alert(a&&a.post_id?"Post was published.":"Post was not published.")}):("not_authorized"===a.status,FB.login())})},a.fbLogin=function(){FB.getLoginStatus(function(b){"connected"===b.status?FB.api("/me",function(b){a.user=b,a.safeApply()}):("not_authorized"===b.status,FB.login())})},a.fbLogout=function(){a.user=null,FB.logout()},a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)}}]);var nyfc=angular.module("nyfcApp"),FormattingOptions={xsmall:{fontSize:12.25,lineheight:12.25},small:{fontSize:16.25,lineheight:16.25},medium:{fontSize:20,lineheight:20},large:{fontSize:30,lineheight:30},xlarge:{fontSize:36,lineheight:36}};nyfc.service("nyfcCanvasService",NyfcCanvasService);var nyfc=angular.module("nyfcApp");nyfc.controller("nyfcCreateController",["$scope","$http","NYFCFirebase","nyfcCanvasService",function(a,b,c,d){a.h,a.s,a.l,a.name="",a.rgbString="hello world",a.user,a.stylesStr="background-color:rgb(255, 255, 255);color:#191919;font:bold 20px sans-serif;line-height:16.25px",a.hslToStyles=function(){{var b=tinycolor({h:a.h,s:a.s,l:a.l});b.toRgbString()}a.stylesStr=d.getStyleString(a.name,b.toRgbString(),a.l)},a.showError=function(a,b){return a.$error[b]},a.validate=function(){var b=!0;return b=a.h>=0&&a.h<=360&&b,b=a.s>=0&&a.s<=1&&b,b=a.l>=0&&a.l<=1&&b,b=a.name&&a.name.length&&a.name.length<=140&&b,Boolean(b)},a.submit=function(){if(a.validate()){a.encouragement=!0;var e={name:a.name,color:a.rgbString,created_at:Firebase.ServerValue.TIMESTAMP,updated_at:Firebase.ServerValue.TIMESTAMP,adult_content:!1,h:a.h,s:a.s,l:a.l,user:a.user||null};a.name=null,c.colors("").push(e);var f=encodeURI(e.name),g=""+e.h+e.s+e.l;f+=String(g).replace(/\./g,"_"),c.names("/"+f).setWithPriority(e,e.name),c.hues("/"+f).setWithPriority(e,e.h),c.saturations("/"+f).setWithPriority(e,e.s),c.lightnesses("/"+f).setWithPriority(e,e.l);var h=String(e.name+"_"+e.h+"_"+e.s+"_"+e.l).split(" ").join("_"),i=d.getNyfcCanvas(e.name,e.color,e.l);b.post("/api/nyfc",{imageData:i.toDataURL("image/png"),name:h}).success(function(){console.log("success message")}),a.user&&a.user.id&&b.get("https://nyfc.firebaseIO.com/users/"+a.user.id+".json").success(function(b){null===b?(a.user.colors=[e],firebase.setWithPriority(a.user,a.user.id)):c.user("/"+a.user.id+"/colors").push(e)}).error(function(a,b){console.log("status",b)})}},a.$watch("name",function(){a.hslToStyles()}),a.$watch("h",function(){a.hslToStyles()}),a.$watch("s",function(){a.hslToStyles()}),a.$watch("l",function(){a.hslToStyles()}),a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)}}]);var nyfc=angular.module("nyfcApp");nyfc.directive("nyfcSpectrum",function(){return{restrict:"EA",template:"<div><input ng-model='rgbString' name='color' required /></div>",replace:!0,link:function(a,b){a.setHSL=function(b,c,d){a.h=b||0,a.s=c||0,a.l=d||0},a.setRgbString=function(b){a.rgbString=b},a.setHSL(240,1,.5);var c=new tinycolor({h:a.h,s:a.s,l:a.l});a.rgbString=c.toRgbString(),b.find("input").first().spectrum({color:"#00f",flat:!0,cancelText:"",move:function(b){var c=b.toHsl();a.setHSL(c.h,c.s,c.l),a.setRgbString(b.toRgbString()),a.safeApply()}})}}});var nyfc=angular.module("nyfcApp");nyfc.controller("nyfcCanvasController",["$scope","$element","$attrs","nyfcCanvasService",function(a,b,c,d){a.$watch("colorObj",function(a){if(a){var c=d.getNyfcCanvas(a.name,a.color,a.l),e=new Image;$(e).attr("title","Right-click to download."),e.src=c.toDataURL("image/png"),$(b[0]).prepend(e)}})}]),nyfc.directive("nyfcCanvas",function(){return{restrict:"EA",replace:!1,template:"",scope:{colorObj:"="},controller:"nyfcCanvasController"}}),angular.module("nyfcApp").factory("NYFCFirebase",function(){function a(a){return new Firebase(i+a)}function b(a){return new Firebase(j+a)}function c(a){return new Firebase(k+a)}function d(a){return new Firebase(l+a)}function e(a){return new Firebase(m+a)}function f(a){return new Firebase(n+a)}function g(g,h){var i;switch(g){case"colors":i=a(h);break;case"user":i=b(h);break;case"name":i=c(h);break;case"hue":i=d(h);break;case"saturation":i=e(h);break;case"lightness":i=f(h);break;default:i=a(h)}return i}var h="https://nyfc.firebaseIO.com",i=h+"/colors",j=h+"/users",k=h+"/names",l=h+"/hues",m=h+"/saturations",n=h+"/lightnesses";return{query:g,colors:a,user:b,names:c,hues:d,saturations:e,lightnesses:f}});var nyfc=angular.module("nyfcApp");nyfc.controller("nyfcDetailController",["$scope","$routeParams","$http",function(a,b,c){a.getNyfcColor=function(){c.get("https://nyfc.firebaseio.com/colors/"+b.id+".json").success(function(c){a.detailobj=c,a.detailobj.id=b.id,a.showDetail=!0,a.safeApply()}).error(function(a,b){console.log("status",b)})},b.id&&a.getNyfcColor(b.id)}]);var nyfc=angular.module("nyfcApp");nyfc.controller("nyfcPaginatedController",["$scope","NYFCFirebase",function(a,b){a.currentPage=null,a.LIMIT=20,a.colors=[],a.pageKeys=[],a.queryStr="colors",a.path="",a.localeStrings={previous:"Previous",previousLoading:"loading...",next:"Next",nextLoading:"loading..."},a.textPrevious=a.localeStrings.previous,a.textNext=a.localeStrings.next,a.setPageKey=function(b){var c=_.keys(b);a.pageKeys.push(c[0]),a.pageKeys=_.uniq(a.pageKeys)},a.getPageKey=function(b){return a.pageKeys[b-1]},a.getLimit=function(){return a.currentPage?a.LIMIT+1:a.LIMIT},a.loadPage=function(){if(b.query){a.query&&a.query.off("value");var c=a.currentPage?a.LIMIT+1:a.LIMIT;a.query=a.currentPage?b.query(a.queryStr,a.path).endAt(null,a.getPageKey(a.currentPage)).limit(c):b.query(a.queryStr,a.path).endAt().limit(c),a.query.on("value",function(b){var c=b.val();a.setButtonText(),a.addColors(c),a.setPageKey(c)})}},a.setButtonText=function(){a.textPrevious=a.localeStrings.previous,a.textNext=a.localeStrings.next},a.addColors=function(b){var c=[];for(var d in b)b.hasOwnProperty(d)&&(b[d].id=d,b[d].name&&(b[d].shortName=b[d].name.length>30?a.truncate(b[d].name):b[d].name),c.unshift(b[d]));a.currentPage&&c.splice(0,1),a.colors=c,a.safeApply()},a.truncate=function(a){return a.substr(0,29)+"..."},a.myColors=function(){a.onlyMyColors?(a.queryStr="user",a.path="/"+a.user.id+"/colors"):(a.queryStr="colors",a.path=""),a.currentPage=null,a.pageKeys=[],a.loadPage()},a.nextPage=function(){a.textNext=a.localeStrings.nextLoading,a.currentPage=a.currentPage+1,a.loadPage()},a.previousPage=function(){a.currentPage-1<0||(a.textPrevious=a.localeStrings.previousLoading,a.currentPage=a.currentPage-1,a.loadPage())},a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)},a.loadPage()}]);